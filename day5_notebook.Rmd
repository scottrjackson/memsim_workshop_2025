---
title: "Data Simulation & Hierarchical Models: Day 5"
date: 2025-08-15
---

# Logistics

  - Updates, revisions

# Agenda

  - review, questions
  - new data: from London
  - summary table tips using `dplyr`
  - testing contrasts with the `multcomp` and `lmerTest` packages
  - full simulation example with London's data
    - simple coefficients
    - random intercept and slopes by subject

# Review, questions

  - 

# Load packages

```{r}
library(tidyverse)
library(lme4)
library(lmerTest)
library(multcomp)
```


# A little exploration of London's data

```{r}
london <- read_csv("nat_similarity_lex.csv")
colnames(london)
xtabs(~ Accuracy, london)

length(unique(london$subject_id))
length(unique(london$target))

london |> group_by(repetition, related) |> summarize(count = n())
london |> group_by(repetition, related, subject_id) |> summarize(count = n()) |>
  summary()

london |> group_by(repetition, related, subject_id) |> 
  summarize(count = n(), meanRT = mean(logRT)) |>
  arrange(meanRT)

london |> group_by(subject_id, repetition, related) |> 
  summarize(count = n())

london |> group_by(subject_id, repetition, related) |> 
  summarize(count = n()) |> summarize(count = n()) |> summarize(count = n())

london |> group_by(subject_id, repetition, related) |> 
  summarize(count = n()) |> ungroup() |> 
  group_by(subject_id) |> summarize(count = n()) |> summary()

ggplot(london, aes(RT)) + geom_histogram()
ggplot(london, aes(logRT)) + geom_histogram()

```


# Contrasts

```{r}
london_lm <- lm(logRT ~ 1 + repetition * related, data = london)
summary(london_lm)

london$related <- relevel(as.factor(london$related), "unrelated")
london$repetition <- relevel(as.factor(london$repetition), "none")

summary(london)

london_lm <- lm(logRT ~ 1 + repetition * related, data = london)
summary(london_lm)

```



| conditions | unrelated  | related    |
|:---        | ---:       | ---:       |
| none       | 0, 0, 0, 0 | 0, 0, 1, 0 |
| hidden     | 0, 1, 0, 0 | 0, 1, 1, 1 |


```{r, eval = FALSE}
test_contrasts <- rbind(c(0, 0, -1, 0),
                        c(0, 0, -1, -1),
                        c(0, 0, -1, -0.5))
rownames(test_contrasts) <- c("relatedness for none condition",
                              "relatedness for hidden condition",
                              "average relatedness across repetition")
print(test_contrasts)
# from lmerTest
# contest1D(london_lm, test_contrasts)

# from multcomp
summary(glht(london_lm, linfct = test_contrasts))
```

Mixed-effect

```{r}
london_lmer1a <- lmer(logRT ~ 1 + repetition * related + (1|subject_id), 
                      data = london)
summary(london_lmer1a)

london_lmer1b <- lmer(logRT ~ 1 + repetition * related + (1 + related|subject_id), 
                      data = london)

summary(london_lmer1b)


# extract some contrasts
summary(glht(london_lmer1b, linfct = test_contrasts))
contest1D(london_lmer1b, test_contrasts[3, ])

```



# Big simulation

```{r}
intercept <- 6.5
related_effect <- -0.03
hidden_effect <- 0.035
related_hidden_interaction <- -0.035

n_per_condition <- 600
london_design <- expand_grid(related = c("related", "unrelated"),
                             repetition = c("hidden", "none"))

slope_matrix <- london_design
slope_matrix$slope <- c(0.035, 0, -0.035, 0.07)

```




