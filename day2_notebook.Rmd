---
title: "Data Simulation & Hierarchical Models: Day 2"
date: 2025-08-12
---

# Using Git in RStudio to pull from GitHub

- Quick demo

# Review and questions

- CLT stuff (see Day 1 notebook)

# Outline for today

- Fit a simple regression
- Simulating data from a regression
- Estimating power through simulation

# Load packages

```{r}
library(MASS)
library(tidyverse)
library(HistData)
```


# Galton (again)

```{r}
head(Galton)
```

## quick regression

```{r}
parent_mean <- mean(Galton$parent)
parent_sd <- sd(Galton$parent)

galton_fit <- lm(child ~ 1 + parent, data = Galton)
print(galton_fit)
galton_fit
summary(galton_fit)

names(galton_fit)
names(summary(galton_fit))
str(galton_fit)
galton_fit$coefficients[2]
galton_fit$coefficients["parent"]

(galton_intercept <- galton_fit$coefficients["(Intercept)"])
(galton_intercept <- galton_fit$coefficients[1])

(galton_slope <- galton_fit$coefficients["parent"])
```


## Visualize model fit

```{r}
ggplot(Galton, aes(parent, child)) + geom_jitter() + 
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE)

ggplot(Galton, aes(parent, child)) + geom_jitter() + 
  geom_abline(aes(intercept = galton_intercept,
                  slope = galton_slope), color = "red", linetype = 2)

ggplot(Galton, aes(parent, child)) + geom_jitter() + 
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) + 
  geom_abline(aes(intercept = galton_intercept,
                  slope = galton_slope), color = "red", linetype = 2)

```

## Using a model to simulate data

y ~ 1 (intercept) + slope * x + (Error)

```{r}
ggplot(Galton, aes(parent, child)) + geom_jitter() + 
  geom_abline(aes(intercept = galton_intercept,
                  slope = galton_slope), color = "red", linetype = 2) +
  xlim(c(0, 74)) + ylim(c(0, 76))

fitted_galton <- galton_fit$fitted.values

ggplot(Galton, aes(parent, child)) + geom_jitter() + 
  geom_line(aes(y = fitted_galton))

```


## Residual error

```{r}
galton_fit$residuals

summary(galton_fit)
(sqrt(sum(galton_fit$residuals^2)/928))
sd(galton_fit$residuals)
(sqrt(sum(galton_fit$residuals^2)/926))

(model_error <- summary(galton_fit)$sigma)

```

## Simulate data

```{r}
sample_size <- nrow(Galton)
galton_fake <- data.frame(parent = rnorm(sample_size, 
                                         mean = parent_mean,
                                         sd = parent_sd))
galton_fake$child <- galton_intercept + 
  galton_slope * galton_fake$parent + 
  rnorm(sample_size, mean = 0, sd = model_error)

ggplot(galton_fake, aes(parent, child)) + geom_point()

ggplot(galton_fake, aes(parent, child)) +
  geom_jitter(aes(x = Galton$parent, y = Galton$child), color = "red") +
  geom_point()
```



```{r}
plot_base <- ggplot(galton_fake, aes(parent, child))
plot_base + geom_point()
```

